# To check for syntax error, run:
# (a) Without an inventory of hosts:
# $ ansible-playbook --key-file ~/.ssh/ansible -i 192.168.100.20,192.168.100.30 bootstrap.yml --syntax-check
# (b) With hostnames/ip in an inventory file
# $ ansible-playbook --key-file ~/.ssh/ansible -i inventory bootstrap.yml --syntax-check
#
# Usage:
#   $ ansible-playbook --key-file ~/.ssh/ansible  -i inventory bootstrap.yml -K


---

- hosts: all
  become: true
  tasks:
    - name: Update all nodes (Ubuntu)
      apt:
        update_cache: yes
      changed_when: false
      when: ansible_distribution == "Ubuntu"

    - name: Update all nodes (OracleLinux)
      dnf:
        update_only: yes
        update_cache: yes
      changed_when: false
      when: ansible_distribution == "OracleLinux"

    - name: Ensure required groups exist
      group:
        name: "{{ item }}"
        state: present
      with_items:
        - admin1
        - adm
        - sudo

    - name: Creating User admin
      user:
        name: admin
        group: admin1
        groups:
         - sudo
         - adm
         - root
        state: present

    - name: Add a sudoer file to admin
      copy:
        src: sudoer_admin
        dest: /etc/sudoers.d/admin
        owner: root
        group: root
        mode: 0440

    - name: Add ansible ssh-key to all nodes for user admin
      authorized_key:
        user: admin
        key: ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICg1N3h0m0XujlaIn58Yv5d5EgA5u4wo2iwdtfTebMWg ansible

...
